# hokum83_microservices
hokum83 microservices repository

# ДЗ-15
- развернут сервер для установки GitLab с установленным докером
- запущен контейнер с GitLab
- установлен пароль админа, запущена админка, отключена регистрация
- создана группа и тестовый проект
- добавлен remote к локальному репозитарию, файлы запушены не гитлаб
- создан пайплайн проекта
- в докере запущен и зарегистрирован раннер
- добавлен исходный код reddit в проект, добавлен файл тестирования проекта, добавлен джоб тестирования в пайплайн
- добавлены окружения, добавлены условия для запуска джобов production и staging в ручном режиме и с наличием тегов
- добавлена задача с определением динамического окружения
- этап build изменен на запуск контейнера с приложением reddit в динамическое окружение
- в папке gitlab-ci/install-gitlab-runner создан файл docker-compose.yml для запуска GitLab раннера в контейнере, создан скрипт gitlab-ci/install-gitlab-runner/register-runner.sh для регистрации раннера в интсансе
- настроены оповещения в слак в канал [#aleksey_gultyaev](https://devops-team-otus.slack.com/archives/C03KD9JLXRV) из GitLab

# ДЗ-14
- выполнен запуск контейнера с разными типами сети
- запущен проект с использованием bridge сети
- запущен проект с использованием 2-х bridge сетей
- выполнен запуск проекта с помощью docker-compose
- файл docker-compose изменен под использование 2-х сетей
- выполнена параметризация через переменные окружения некоторых параметров, параметры записаны в .env
- базовое имя берется из названия каталога, откуда запускается docker-compose, изменить можно через переменную окружения COMPOSE_PROJECT_NAME
- создан docker-compose.override.yml с подключением к каждому контейнеру волюма из хоста с возможностью подменить код из образа, запуск puma дополнен флагами --debug и -w 2

# ДЗ-13
Что сделано:
- установлен линтер hadolint
- скачен и распакован архив с исходниками приложений
- созданы докерфайлы для каждого приложения, сделаны оптимизации согласно рекомендаций линтера, собраны образы
- запущены контейнеры, выполнена проверка работы приложения
- запущены контейнеры с переопределением переменных окружения через опцию -e:
```
docker run -d --network=reddit --network-alias=mypost_db --network-alias=mycomment_db mongo:latest
docker run -d --network=reddit -e POST_DATABASE_HOST=mypost_db --network-alias=mypost hokum83/post:1.0
docker run -d --network=reddit -e COMMENT_DATABASE_HOST=mycomment_db --network-alias=mycomment hokum83/comment:1.0
docker run -d --network=reddit -e POST_SERVICE_HOST=mypost -e COMMENT_SERVICE_HOST=mycomment -p 9292:9292 hokum83/ui:1.0
```
- образ приложения ui переделан, выполнены рекомендации линтера, образ существенно уменьшился (до 411Мб против 762Мб в первой версии)
- образ приложения ui пересобран на основе alpine linux - размер сократился до 148Мб
- образ приложения comment так же был переведен на alpine и оптимизирован, размер стал 146Мб против 759Мб изначально
- выполнен запуск приложения
- создан docker volume, подключен к контейнеру БД
- выполнен запуск контейнеров, написан пост, контейнеры были перезапущены - пост остался на месте

# ДЗ-12
Что сделано:
- установлен docker и необходимое ПО, запущен первый контейнер
- создан образ на основе запущенного контейнера
- создан докер хост в облаке yandex
- собран образ и запущен контейнер на его основе для запуска приложения reddit
- образ загружен на docker hub, выполнен запуск контейнера с загрузкой образа из docker hub
- создан шаблон пакера с установленным докером, подготовлен конфиг терраформ для поднятия инстансов на его основе, подготовлен плейбук для запуска контейнера с приложением
